{% extends 'back01/base.html' %}

{% block static_files %}


{% endblock %}

{% block body_part %}
<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="fa fa-table"></i> Table</h3>
                <ol class="breadcrumb">
                    <li><i class="fa fa-home"></i><a href="index.html">主页</a></li>
                    <li><i class="fa fa-table"></i>文章管理</li>
                    <li><i class="fa fa-th-list"></i>查看</li>
                </ol>
            </div>
        </div>
        <!-- page start-->
        <div class="row">
            <div class="col-lg-12">
                <section class="panel">
                    <header class="panel-heading">
                        Advanced Table
                    </header>

                    <table class="table table-striped table-advance table-hover">
                        <tbody>
                        <tr>
                            <th></i>标题</th>
                            <th>创建人</th>
                            <th>发布人</th>
                            <th>最后修改人</th>
                            <th>创建时间</th>
                            <th>发布时间</th>
                            <th>最后修改时间</th>
                            <th>发布标志</th>
                        </tr>

                        {% for article in articles %}
                        <tr articleId="{{article.article_id}}">
                            <td width="200">{{article.title}}</td>
                            <td>{{article.creator_id}}</td>
                            <td>{{article.publish_id}}</td>
                            <td>{{article.last_modified_id}}</td>
                            <td>{{article.create_time}}</td>
                            <td>{{article.publish_time}}</td>
                            <td>{{article.last_modified_time}}</td>
                            {% if article.publish_sign == 0 %}
                                <td>未发布</td>
                            {% elif article.publish_sign == 1%}
                                <td>已发布</td>
                            {% else %}
                                <td>已发布正在编辑</td>
                            {% endif %}
                            <td>
                                <div class="btn-group">
                                    <a class="btn btn-primary" href="{{url_for('back.modifiesNews',article_id = article.article_id)}}"><i class="icon_plus_alt2">修改</i></a>
                                    <a class="btn btn-danger" onclick="MAIN.doRemove(this)"><i class="icon_close_alt2">删除</i></a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </section>
            </div>
        </div>
        <div class="text-center">
            <div>
                <ul class="pagination pagination-lg">
                    {% if pagination.has_prev %}
                        <li><a href="{{url_for('back01.articleList',page = pagination.page - 1)}}">«</a></li>
                    {% endif %}

                    {% for p in pagination.iter_pages() %}
                        {% if p == pagination.page%}
                             <li class="active"><a href="{{url_for('back.manageNews',page = p)}}">{{loop.index}}</a></li>
                        {% else %}
                            <li><a href="{{url_for('back.manageNews',page = p)}}">{{loop.index}}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if pagination.has_next %}
                        <li><a href="{{url_for('back.manageNews',page = pagination.page + 1)}}">»</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </section>
</section>

<script>
    var MAIN = {};

    MAIN.doRemove = function (e) {
        var req = {};
        var trow = $(e).parents('tr:first') //找到这一行的tr元素
        req.articleId = trow.attr('articleId')
        Af.jsonp("/back01/deleteArticle",req,
            function (data) {
            alert(data)
            $(e).parents('tr:first').remove();
        })
    }
</script>
{% endblock%}