{% extends 'back01/back/base.html' %}

{% block static_files %}


{% endblock %}

{% block body_part %}
<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="fa fa-table"></i> Table</h3>
                <ol class="breadcrumb">
                    <li><i class="fa fa-home"></i><a href="index.html">主页</a></li>
                    <li><i class="fa fa-table"></i>资料管理</li>
                    <li><i class="fa fa-th-list"></i>所有资料</li>
                </ol>
            </div>
                  <div class="col-lg-2">
                                        <!--<button class="btn btn-primary" onclick="MAIN.onQuery(0)">查看全部资料</button>-->
                                    <!--</div>-->
                         <!--<div class="col-lg-2">-->
                                        <!--<button class="btn btn-primary" onclick="MAIN.onQuery(1)">管理员上传的资料</button>-->
                                    <!--</div>-->
                         <!--<div class="col-lg-2">-->
                                        <!--<button class="btn btn-primary" onclick="MAIN.onQuery(2)">新闻上传的附件</button>-->
                                    <!--</div>-->
                         <!--<div class="col-lg-2">-->
                                        <!--<button class="btn btn-primary" onclick="MAIN.onQuery(3)">项目上传的附件</button>-->
                                    <!--</div>-->
        </div>
        <!-- page start-->
        <div class="row">
            <div class="col-lg-12">
                <section class="panel">
                    <!--<header class="panel-heading">-->
                        <!--Advanced Table-->
                    <!--</header>-->


                    <table class="table table-striped table-advance table-hover">
                        <tbody>
                        <tr>
                            <th></i>标题</th>
                            <th>来源</th>
                        </tr>

                        {% for file in files %}
                        <tr filename="{{file.name}}">
                            <td width="200">{{file.name}}</td>

                            {% if file.source == 1 %}
                                <td>资料下载</td>
                            {% elif file.source == 2%}
                                <td>新闻附件</td>
                            {% else %}
                                <td>项目附件</td>
                            {% endif %}
                            <td>
                                <div class="btn-group">
                                       <button class="btn btn-danger delete" id="delete"  onclick="MAIN.doRemove(0)" p_id="{{file.fid}}">删除</button>

                                    <!--<a class="btn btn-danger" href="{{url_for('back.deleteFile')}}?fid={{file.fid}}"><i class="icon_close_alt2">删除</i></a>-->
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </section>
            </div>
        </div>
        <div class="text-center">
            <div>
                <ul class="pagination pagination-lg">
                    {% if pagination.has_prev %}
                        <li><a href="{{url_for('back.manageResource',page = pagination.page - 1,count = 10)}}?source=0">«</a></li>
                    {% endif %}

                    {% for p in pagination.iter_pages() %}
                        {% if p == pagination.page%}
                             <li class="active"><a href="{{url_for('back.manageResource',page = p,count = 10)}}?source=0">{{loop.index}}</a></li>
                        {% else %}
                            <li><a href="{{url_for('back.manageResource',page = p,count = 10)}}?source=0">{{loop.index}}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if pagination.has_next %}
                        <li><a href="{{url_for('back.manageResource',page = pagination.page + 1,count = 10)}}?source=0">»</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </section>
</section>
{% endblock %}

{% block js_files %}
<script>

    var MAIN = {};

        MAIN.onQuery = function (type) {
        window.location.href="/admin/manageResource?source="+type;
         <!--var req = {};-->
         <!--req.source =type;-->
           <!--$.ajax({-->
                <!--url:"/admin/manageResource",-->
                <!--type:"GET",-->
                <!--data:{ source: type},-->
                <!--dataType:"json",-->

            <!--});-->

    }



    MAIN.doRemove = function (e) {
          
            var data={};
            data.nid=$(this).attr("p_id");
            n = $(this).attr("p_id");
            console.log(data.pid);
            $.ajax({
                url:"/api/admin/deleteFile?fid="+n,
                type:"get",
                success: function (data) {
                    alert("删除成功"); //提交成功
                    window.location.href="{{url_for('back.manageResource')}}?type=0"
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert("删除失败");  //提交失败
                }
            });
    }
</script>
{% endblock%}