{% extends 'back01/back/base.html' %}

{% block static_files %}
<script type="text/javascript" src="/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.all.js"></script>

<style>
    h4 {
        margin:20px 0;
        font-weight: bold;
    }
    .table>tbody>tr>td{
        border-top: 0px;
    }
</style>
{% endblock %}

{% block body_part %}
<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <div class="col-lg-9" style="min-height: 800px">
                    <h2>{{project.pname}}</h2>
                    <p>{{project.content | safe}}</p>
                </div>
                <div class="col-lg-2">
                    <h4>封面图片</h4>
                    <img style="width: 100%;height: 200px;" src="{{url_for('common.image',name=project.mainPic)}}">
                    <h4>项目类别</h4>
                    <p>{{project.type}}</p>

                <h4>项目成员</h4>
                <table class="table">
                    <tbody>
                {% for member in project.members %}
                {% if member.type==1 %}    <!--学生类型1-->
                    <tr>
                        <td>{{member.name}}</td>
                        <td>{{member.academy}}</td>
                        <td>{{member.grade}}</td>
                    </tr>

                {% endif %}
                {% endfor %}
                   </tbody>
                </table>

                <h4>指导老师</h4>
                <table class="table">
                    <tbody>
                {% for member in project.members %}
                {% if member.type==0 %}    <!--老师类型0-->

                    <tr>
                        <td>{{member.name}}</td>
                        <td>{{member.brief}}</td>
                    </tr>
                {% endif %}
                {% endfor %}
                     </tbody>
                </table>

                {% for award in project.awards %}
                    <h4>所获奖项</h4>
                    <p>{{ award.awardName }}</p>
                    <h4>获奖链接</h4>
                    <a class="links" href="{{ award.honorLink }}" style="color: #666;text-decoration: none">{{award.honorLink}}</a>
                    <h4>获奖证书</h4>
                    {% for i in award.pics %}
                    <img style="width: 100%;height: 200px" src="{{ url_for('common.image',name=i) }}" alt="">
                    {% endfor %}
                {% endfor %}

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label class="col-lg-2 control-label">审核意见</label>
                        <textarea class="advice" cols="80" rows="10"></textarea>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-offset-2">
                            <button type="button" class="btn btn-primary" id="pass" p_id="{{project.pid}}">审核通过</button>
                            <button type="button" class="btn btn-danger" id="notpass" p_id="{{project.pid}}">审核不通过</button>
                        </div>

                    </div>
                </form>
            </div>
        </div>

    </section>
</section>
{% endblock %}

{% block js_files %}

<script>
    $(function () {
        //获奖链接去掉""
        var rawLink=$(".links").text();
        var link=rawLink.slice(1,rawLink.length-1);
        $(".links").attr("href",link);
        $(".links").text(link);


        //审核通过
        $("#pass").click(function () {
            console.log("test");
            var data={};
            data.pid=$(this).attr("p_id");
            data.operation=1;
            data.msg=$(".advice").val();
            $.ajax({
                url:"/api/admin/checkoutPro",
                type:"post",
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (data) {
                    alert(data.msg); //提交成功
                    window.location.href="{{url_for('back.checkProjects')}}";
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert(data.msg);  //提交失败
                }
            });
        });
        //审核不通过
        $("#notpass").click(function () {
            console.log("test");
            var data={};
            data.pid=$(this).attr("p_id");
            data.operation=0;
            data.msg=$(".advice").val();
            $.ajax({
                url:"/api/admin/checkoutPro",
                type:"post",
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (data) {
                    alert(data.msg); //提交成功
                    window.location.href="{{url_for('back.checkProjects')}}"
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert(data.msg);  //提交失败
                }
            });
        });
    })
</script>

{% endblock %}