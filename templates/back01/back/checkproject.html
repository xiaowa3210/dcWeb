{% extends 'back01/back/base.html' %}

{% block static_files %}
<script type="text/javascript" src="/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.all.js"></script>

<style>
    h4 {
        margin:20px 0;
        font-weight: bold;
    }
    .table>tbody>tr>td{
        border-top: 0px;
    }
</style>
{% endblock %}

{% block body_part %}
<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <div class="col-lg-9" style="min-height: 800px">
                    <h2>{{project.pname}}</h2>
                    <p>{{project.content | safe}}</p>
                </div>
                <div class="col-lg-2">
                    <img style="width:300px;height:200px" src="{{ url_for('common.image',name=project.pic.path) }}">
                    <h4>项目类别</h4>
                    {% if project.type==1 %}
                        <p>App开发/微信小程序开发</p>
                    {% endif %}
                    {% if project.type==2 %}
                        <p>通信/网络</p>
                    {% endif %}
                    {% if project.type==3 %}
                        <p>软件系统</p>
                    {% endif %}
                    {% if project.type==4 %}
                        <p>硬件系统</p>
                    {% endif %}
                    {% if project.type==5 %}
                        <p>视频/图像</p>
                    {% endif %}
                    {% if project.type==6 %}
                        <p>大数据/机器学习</p>
                    {% endif %}
                    <h4>项目专业</h4>
                    <p>{{project.major}}</p>
                    <h4>立项时间</h4>
                    <p>{{ project.startTime }}</p>
                    <h4>项目成员</h4>
                    {% for member in project.members %}
                        {% if member.type==1 %}    <!--学生类型1-->
                        <div>
                            <p><span>{{ member.name }}|</span><span>{{ member.number  }}|</span><span>{{ member.classId }}</span></p>
                            <p><span>{{ member.grade }}|</span><span>{{ member.major }}|</span><span>{{ member.academy }}</span></p>
                        </div>
                        {% endif %}
                    {% endfor %}
                     <h4>指导老师</h4>
                    {% for member in project.members %}
                    {% if member.type==0 %}    <!--老师类型0-->
                        <p><span>{{ member.name }}|</span><span>{{ member.major }}|</span><span>{{ member.academy }}</span></p>
                    {% endif %}
                    {% endfor %}
                    <h4>所获奖项</h4>
                    {% for award in project.awards %}
                        <p><span>{{ award.awardName }}|</span><span>{{ award.awardTime }}</span></p>
                        <p><span>{{ award.rank }}</span></p>
                        <p>
                            {% for i in award.pics %}
                            <img height="200" src="{{ url_for('common.image',name=i.url) }}" alt="">
                            {% endfor %}
                        </p>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label class="col-lg-2 control-label">审核意见</label>
                        <textarea class="advice" cols="80" rows="10"></textarea>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-offset-2">
                            <button type="button" class="btn btn-primary" id="pass" p_id="{{project.pid}}">审核通过</button>
                            <button type="button" class="btn btn-danger" id="notpass" p_id="{{project.pid}}">审核不通过</button>
                        </div>

                    </div>
                </form>
            </div>
        </div>

    </section>
</section>
{% endblock %}

{% block js_files %}

<script>
    $(function () {
        //获奖链接去掉""
        var rawLink=$(".links").text();
        var link=rawLink.slice(1,rawLink.length-1);
        $(".links").attr("href",link);
        $(".links").text(link);


        //审核通过
        $("#pass").click(function () {
            console.log("test");
            var data={};
            data.pid=$(this).attr("p_id");
            data.operation=1;
            data.msg=$(".advice").val();
            $.ajax({
                url:"/api/admin/checkoutPro",
                type:"post",
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (data) {
                    alert(data.msg); //提交成功
                    window.location.href="{{url_for('back.checkProjects')}}";
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert(data.msg);  //提交失败
                }
            });
        });
        //审核不通过
        $("#notpass").click(function () {
            console.log("test");
            var data={};
            data.pid=$(this).attr("p_id");
            data.operation=0;
            data.msg=$(".advice").val();
            $.ajax({
                url:"/api/admin/checkoutPro",
                type:"post",
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (data) {
                    alert(data.msg); //提交成功
                    window.location.href="{{url_for('back.checkProjects')}}"
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert(data.msg);  //提交失败
                }
            });
        });
    })
</script>

{% endblock %}