{% extends 'back01/back/base.html' %}

{% block static_files %}
<script type="text/javascript" src="/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.all.js"></script>

<style>

</style>
{% endblock %}

{% block body_part %}

<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="fa fa-table"></i> Table</h3>
                <ol class="breadcrumb">
                    <li><i class="fa fa-home"></i><a href="index.html">主页</a></li>
                    <li><i class="fa fa-table"></i>文章管理</li>
                    <li><i class="fa fa-th-list"></i>未发布</li>
                </ol>
            </div>
        </div>
            <!--<div class="col-lg-2">-->
                                        <!--<button class="btn btn-primary" onclick="MAIN.onQuery(-1)">查看全部新闻</button>-->
                                    <!--</div>-->
                         <!--<div class="col-lg-2">-->
                                        <!--<button class="btn btn-primary" onclick="MAIN.onQuery(0)">查看未发布新闻</button>-->
                                    <!--</div>-->
                         <!--<div class="col-lg-2">-->
                                        <!--<button class="btn btn-primary" onclick="MAIN.onQuery(1)">查看已发布新闻</button>-->
                                    <!--</div>-->
        <!--</div>-->
        <!-- page start-->
        <div class="row">
            <div class="col-lg-12">
                <section class="panel">

                    <table class="table table-striped table-advance table-hover">
                        <tbody>
                        <tr>
                            <th></i>标题</th>
                            <th>是否置顶</th>
                            <th>创建人</th>
                            <th>发布人</th>
                            <th>最后修改人</th>
                            <th>创建时间</th>
                            <th>最后修改时间</th>
                            <th>发布标志</th>
                        </tr>

                        {% for article in news %}
                        <tr articleId="{{article.nid}}">
                            <td width="200">{{article.title}}</td>
                              {% if article.isTop == 1 %}
                                <td>置顶</td>
                            {% elif article.isTop == 0%}
                                <td>未置顶</td>
                                {% endif %}
                            <td>{{article.creater}}</td>
                            <td>{{article.publisher}}</td>
                            <td>{{article.modifier}}</td>
                            <td>{{article.createTime}}</td>
                             <td>{{article.createTime}}</td>
                            <td>{{article.modifiedTime}}</td>
                             {% if article.status == 1 %}
                                <td>未提交</td>
                            {% elif article.status == 2%}
                                <td>审核中</td>
                            {% elif article.status == 3 %}
                                <td>已发布</td>
                            {% endif %}
                            <td>
                                <div class="btn-group">
                                     {% if session.admin.type == 2 %}
                                    <button class="btn btn-success" ><a href="{{url_for('back.modifiesNews',nid=article.nid)}}">修改</a></button>
                                     {% endif %}
                                    <!--<a class="btn btn-primary" href="{{url_for('back.modifiesNews',nid = article.nid)}}"><i class="icon_plus_alt2">修改</i></a>-->
                                    <!--<a class="btn btn-danger delete"  p_id="{{article.nid}}" ><i class="icon_close_alt2">删除</i></a>-->
                                      <button class="btn btn-danger delete" id="delete" p_id="{{article.nid}}">删除</button>
                                      {% if article.status == 0 %}
                                      <button class="btn btn-success publish"   id="publish" p_id="{{article.nid}}">发布</button>
                                <!--<a class="btn btn-primary" href="{{url_for('back.releaseNew',nid = article.nid)}}"><i class="icon_plus_alt2">发布</i></a>-->
                            {% elif article.status == 1%}
                                    <button class="btn btn-danger chehui"   id="chehui" p_id="{{article.nid}}">撤销</button>
                                <!--<a class="btn btn-danger" href="{{url_for('back.undoNew',nid = article.nid)}}"><i class="icon_close_alt2">撤销</i></a>-->
                             {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </section>
            </div>
        </div>
        <div class="text-center">
            <div>
                <ul class="pagination pagination-lg">
                    {% if pagination.has_prev %}
                        <li><a href="{{url_for('back.manageNews',page = pagination.page - 1,count=10)}}?type=0">«</a></li>
                    {% endif %}

                    {% for p in pagination.iter_pages() %}
                        {% if p == pagination.page%}
                             <li class="active"><a href="{{url_for('back.manageNews',page = p,count=10)}}?type=0">{{loop.index}}</a></li>
                        {% else %}
                            <li><a href="{{url_for('back.manageNews',page = p,count=10)}}?type=0">{{loop.index}}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if pagination.has_next %}
                        <li><a href="{{url_for('back.manageNews',page = pagination.page + 1,count=10)}}?type=0">»</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </section>
</section>
{% endblock %}

{% block js_files %}
<script>

  $(function () {
        $(".delete").click(function () {
            var data={};
            data.nid=$(this).attr("p_id");
            n = $(this).attr("p_id");
            console.log(data.pid);
            $.ajax({
                url:"/api/admin/deleteNew/"+n,
                type:"get",
                success: function (data) {
                    alert("删除成功"); //提交成功
                    window.location.href="{{url_for('back.manageNews')}}?type=0"
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert("删除失败");  //提交失败
                }
            });
        });

        $(".publish").click(function () {
             n = $(this).attr("p_id");
            $.ajax({
                url:"/api/admin/releaseNew/"+n,
                type:"get",
                success: function (data) {
                    alert("发布成功"); //提交成功
                    window.location.href="{{url_for('back.manageNews')}}?type=0"
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert("发布失败");  //提交失败
                }
             });
         });

           $(".chehui").click(function () {
            var data={};
            data.nid=$(this).attr("p_id");
            n = $(this).attr("p_id");
            console.log(data.pid);
            $.ajax({
                url:"/api/admin/undoNew/"+n,
                type:"get",
                success: function (data) {
                    alert("撤回成功"); //提交成功
                    window.location.href="{{url_for('back.manageNews')}}?type=0"
                    //window.location.href='';//跳转到个人中心
                },
                error: function (data) {
                    alert("撤回失败");  //提交失败
                }
            });
        });
         })






</script>
{% endblock %}